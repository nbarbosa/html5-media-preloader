/*! media-preloader 05-10-2015 */
!function(a,b){"use strict";function c(a){var b=this;this.contents=null;var c={fromRoot:!0,inclusiveItems:[]};if("undefined"!=typeof a)for(var d in c)d in a||(a[d]=c[d]);this.options=a;try{if("undefined"==typeof this.options.href)throw new Error("No target file has been informed.");var e=new window.XMLHttpRequest;e.open("GET",this.options.href,!0),e.onreadystatechange=function(){try{if(4===e.readyState){if(200!==e.status)throw new Error(e.statusText);if(""===e.responseText||"{}"===JSON.stringify(JSON.parse(e.responseText)))throw new Error("Response is empty");b.contents=JSON.parse(e.responseText),b.queueContents()}}catch(a){b.options.error(a)}},e.onerror=function(a){throw new Error(a)},e.send()}catch(f){"undefined"!=typeof b.options.error?b.options.error(f):console.log(f)}}function d(){this.totalCount=0,this.successCount=0,this.errorCount=0,this.downloadQueue=[],this.percentCompleted=0}c.prototype.queueContents=function(){var a=this,b=new d;if("undefined"==typeof this.contents.item)throw new Error('"item" collection does not exist.');if(this.options.fromRoot===!0&&("undefined"==typeof a.contents.root||""===a.contents.root))throw new Error('"root" path does not exist.');this.options.inclusiveItems.length>0&&a.contents.item.push.apply(a.contents.item,this.options.inclusiveItems);for(var c=0;c<this.contents.item.length;c++){var e=this.contents.item[c];"undefined"!=typeof e.href&&(this.options.fromRoot===!0&&(e.href=a.contents.root+"/"+e.href),b.queueDownload(e))}b.totalCount=b.downloadQueue.length,b.downloadAll(a.options.updateCallback,a.options.doneCallback)},d.prototype.download=function(a,b,c){function d(a){return/\.(jpg|jpeg|png|gif|svg)$/.test(a.toLowerCase())}function e(a){return/\.(oga|wav|mp3|m4a)$/.test(a.toLowerCase())}function f(){m===!1&&(m=!0,l.pause(),l=null,a&&a(),c&&c())}function g(){b&&b(),c&&c()}if(this.downloadQueue.length>0){var h=this.downloadQueue.shift(),i=h.href;if(d(i)){var j=new Image;j.src=i;try{j.addEventListener("load",function(){a&&a(),c&&c()}),j.addEventListener("error",function(){b&&b(),c&&c()})}catch(k){b&&b(),c&&c()}}else if(e(i))try{var l=new Audio;l.volume=0,l.autoplay=!0;var m=!1;l.addEventListener("canplay",f),l.addEventListener("canplaythrough",f),l.addEventListener("loadeddata",f),l.addEventListener("error",g),l.src=i,l.load()}catch(k){b&&b(),c&&c()}else{var n=new window.XMLHttpRequest;n.onload=function(){try{if(200!==n.status)throw new Error("Error loading resource.");a&&a(),c&&c()}catch(d){b&&b(),c&&c()}},n.onerror=function(){b&&b(),c&&c()},n.open("GET",i),n.send()}}},d.prototype.downloadAll=function(a,b){function c(){d.updateProgress(a),d.downloadQueue.length>0?d.download(function(){d.countSuccess()},function(){d.countError()},c):"function"==typeof b&&b(d.successCount,d.errorCount)}var d=this;if(0===this.downloadQueue.length&&"function"==typeof b)throw new Error("Nothing to load, queue is empty.");c()},d.prototype.countSuccess=function(){this.successCount+=1},d.prototype.countError=function(){this.errorCount+=1},d.prototype.queueDownload=function(a){this.downloadQueue.push(a)},d.prototype.updateProgress=function(a){this.percentCompleted=parseInt((this.successCount+this.errorCount)/this.totalCount*100,10),"function"==typeof a&&a(this.percentCompleted)},c.VERSION="0.0.1",a.MediaPreloader=c}(this);